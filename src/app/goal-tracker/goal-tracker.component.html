<div class="two-column-layout">
  <!-- Left Column: Goals -->
  <div class="goals-sidebar">
    <div class="sidebar-header">
      <h2>Goal Tracker</h2>
      <p class="subtitle">Track your learning and work goals</p>
    </div>

    <!-- Add new goal form -->
    <div class="add-goal-section">
      <h3>Add New Goal</h3>
      <div class="form-row">
        <input [(ngModel)]="newGoal.title" placeholder="Goal title" class="input-field" />
        <input [(ngModel)]="newGoal.description" placeholder="Description" class="input-field" />
        <input [(ngModel)]="newGoal.dueDate" type="date" class="input-field date-input" />
        <button (click)="addGoal()" class="add-btn">Add Goal</button>
      </div>
    </div>

    <!-- Goals list -->
    <div class="goals-list">
      <div *ngIf="goals.length === 0" class="no-goals">No goals yet. Add your first goal above!</div>
      
      <div *ngFor="let goal of goals" 
           class="goal-card" 
           [class.completed]="goal.isCompleted"
           [class.active]="selectedGoalId === goal.id"
           (click)="selectGoal(goal.id)">
        <div class="goal-header">
          <div class="goal-left">
            <input type="checkbox" [checked]="goal.isCompleted" (change)="toggleGoal(goal)" (click)="$event.stopPropagation()" class="checkbox" />
            <div class="goal-info">
              <div *ngIf="!editingGoal[goal.id]">
                <h4 [class.completed-text]="goal.isCompleted">{{ goal.title }}</h4>
                <p class="goal-description">{{ goal.description }}</p>
                <div class="goal-meta">
                  <span *ngIf="goal.dueDate" class="due-date">Due: {{ goal.dueDate }}</span>
                  <span class="progress-badge">{{ getCompletedCount(goal) }} tasks</span>
                </div>
              </div>
              <div *ngIf="editingGoal[goal.id]" class="edit-mode">
                <input [(ngModel)]="goal.title" class="edit-input title-edit" />
                <input [(ngModel)]="goal.description" class="edit-input" />
                <input [(ngModel)]="goal.dueDate" type="date" class="edit-input" />
              </div>
            </div>
          </div>
          <div class="goal-actions">
            <button *ngIf="!editingGoal[goal.id]" (click)="startEditGoal(goal.id); $event.stopPropagation()" class="edit-action-btn">Edit</button>
            <button *ngIf="editingGoal[goal.id]" (click)="saveGoal(goal); $event.stopPropagation()" class="save-btn">Save</button>
            <button (click)="deleteGoal(goal.id); $event.stopPropagation()" class="delete-btn">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resize handle -->
  <div class="resize-handle" 
       (mousedown)="onResizeStart($event)"
       (touchstart)="onTouchStart($event)"></div>

  <!-- Right Column: SubTasks -->
  <div class="subtasks-content">
    <div *ngIf="selectedGoal" class="subtasks-container">
      <div class="subtasks-header">
        <h2>Sub-tasks for {{ selectedGoal.title }}</h2>
        <button (click)="toggleSort(selectedGoal.id)" class="sort-toggle-btn">
          {{ sortByDate[selectedGoal.id] ? 'ðŸ“… Date Sort' : 'ðŸ”¢ Manual Order' }}
        </button>
      </div>

      <div class="add-subtask">
        <input [ngModel]="(newSubTask[selectedGoal.id] || {}).content || ''" 
               (ngModelChange)="updateSubTaskContent(selectedGoal.id, $event)"
               placeholder="Add sub-task" 
               class="subtask-input" />
        <input [ngModel]="(newSubTask[selectedGoal.id] || {}).dueDate || ''" 
               (ngModelChange)="updateSubTaskDate(selectedGoal.id, $event)"
               type="date" 
               class="subtask-date" />
        <button (click)="addSubTask(selectedGoal.id)" class="add-subtask-btn">Add</button>
      </div>

      <div *ngIf="selectedGoal.subTasks.length === 0" class="no-subtasks">No sub-tasks yet</div>
      
      <div cdkDropList 
           (cdkDropListDropped)="onSubTaskDrop($event, selectedGoal.id)"
           [cdkDropListDisabled]="sortByDate[selectedGoal.id]"
           class="subtasks-list">
        <div *ngFor="let subTask of selectedGoal.subTasks" 
             cdkDrag 
             [cdkDragDisabled]="sortByDate[selectedGoal.id]"
             class="subtask-item" 
             [class.drag-disabled]="sortByDate[selectedGoal.id]">
          <div class="drag-handle" *ngIf="!sortByDate[selectedGoal.id]">â‹®â‹®</div>
          <input type="checkbox" [checked]="subTask.isCompleted" (change)="toggleSubTask(selectedGoal.id, subTask)" class="checkbox" />
          <span *ngIf="!editingSubTask[subTask.id]" [class.completed-text]="subTask.isCompleted">{{ subTask.content }}</span>
          <input *ngIf="editingSubTask[subTask.id]" [(ngModel)]="subTask.content" class="subtask-edit-input" />
          <span *ngIf="subTask.dueDate && !editingSubTask[subTask.id]" class="subtask-due">{{ subTask.dueDate }}</span>
          <input *ngIf="editingSubTask[subTask.id]" [(ngModel)]="subTask.dueDate" type="date" class="subtask-date-edit" />
          <button *ngIf="!editingSubTask[subTask.id]" (click)="startEditSubTask(subTask.id)" class="edit-subtask-btn">âœŽ</button>
          <button *ngIf="editingSubTask[subTask.id]" (click)="saveSubTask(subTask)" class="save-subtask-btn">âœ“</button>
          <button (click)="deleteSubTask(subTask.id)" class="delete-subtask-btn">Ã—</button>
        </div>
      </div>
    </div>

    <div *ngIf="!selectedGoal" class="no-selection">
      <p>Select a goal to view sub-tasks</p>
    </div>
  </div>
</div>
