<div class="monthly-reminders-container">
  <div class="header-section">
    <h2>Monthly Reminders</h2>
    <p class="subtitle">Manage your recurring monthly bills and reminders</p>
  </div>

  <div class="month-selector">
    <div class="selector-group">
      <label>Month:</label>
      <select [(ngModel)]="selectedMonth" (change)="onMonthYearChange()" class="month-select">
        <option *ngFor="let month of months" [value]="month.value">
          {{ month.name }}
        </option>
      </select>
    </div>
    
    <div class="selector-group">
      <label>Year:</label>
      <select [(ngModel)]="selectedYear" (change)="onMonthYearChange()" class="year-select">
        <option [value]="2024">2024</option>
        <option [value]="2025">2025</option>
        <option [value]="2026">2026</option>
        <option [value]="2027">2027</option>
        <option [value]="2028">2028</option>
      </select>
    </div>
  </div>

  <div class="add-reminder-section">
    <h3>Add New Reminder for {{ getMonthName() }} {{ selectedYear }}</h3>
    
    <div class="common-reminders">
      <label>Quick Select:</label>
      <div class="common-buttons">
        <button 
          *ngFor="let reminder of commonReminders" 
          (click)="selectCommonReminder(reminder)"
          class="common-btn"
          type="button">
          {{ reminder }}
        </button>
      </div>
    </div>

    <div class="add-form">
      <div class="form-row">
        <div class="due-date-selector">
          <label>Due Date:</label>
          <select [(ngModel)]="selectedDay" class="day-select">
            <option *ngFor="let day of getDaysInMonth()" [value]="day">
              {{ getFormattedDate(day) }}
            </option>
          </select>
        </div>
        
        <input 
          [(ngModel)]="newReminder.title" 
          placeholder="Reminder title (e.g., Phone Bill)"
          class="title-input"
          type="text">
        
        <input 
          [(ngModel)]="newReminder.description" 
          placeholder="Description (optional)"
          class="description-input"
          type="text">
        
        <button (click)="addReminder()" class="add-btn">
          <i class="glyphicon glyphicon-plus"></i> Add
        </button>
      </div>
    </div>
  </div>

  <div class="reminders-list">
    <h3>Reminders for {{ getMonthName() }} {{ selectedYear }}</h3>
    
    <div *ngIf="getAllPendingReminders().length === 0 && getAllCompletedReminders().length === 0" class="no-reminders">
      No reminders set for this month. Add some above!
    </div>
    
    <div *ngIf="getAllPendingReminders().length > 0" class="main-section">
      <div class="main-section-header">
        <h4 class="section-title pending">Pending Reminders ({{ getAllPendingReminders().length }})</h4>
      </div>
      
      <div class="section-reminders">
        <div *ngFor="let reminder of getAllPendingReminders()" class="reminder-item">
          <div class="reminder-checkbox">
            <input 
              type="checkbox" 
              [checked]="reminder.isCompleted"
              (change)="toggleCompletion(reminder)"
              class="completion-checkbox">
          </div>
          
          <div class="reminder-content">
            <div class="editable-field">
              <h5 *ngIf="!editingTitle[reminder.id]">{{ reminder.title }}</h5>
              <input 
                *ngIf="editingTitle[reminder.id]"
                type="text" 
                [value]="reminder.title"
                (blur)="onTitleChange(reminder, $event)"
                (keyup.enter)="onTitleChange(reminder, $event)"
                class="edit-input title-input">
              <button (click)="toggleEditTitle(reminder.id)" class="edit-btn" title="Edit title">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div class="editable-field">
              <p *ngIf="!editingDay[reminder.id]" class="reminder-date">{{ getFormattedDate(reminder.day) }}</p>
              <select 
                *ngIf="editingDay[reminder.id]"
                [value]="reminder.day"
                (change)="onDayChange(reminder, $event)"
                (blur)="toggleEditDay(reminder.id)"
                class="edit-input day-input">
                <option *ngFor="let day of getDaysInMonth()" [value]="day">
                  {{ getFormattedDate(day) }}
                </option>
              </select>
              <button (click)="toggleEditDay(reminder.id)" class="edit-btn" title="Edit day">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div class="due-date-display">
              <span class="due-label">Due Date:</span>
              <span class="due-value">{{ getFormattedDate(reminder.day) }}</span>
            </div>
            
            <div *ngIf="reminder.description || editingDescription[reminder.id]" class="editable-field">
              <p *ngIf="!editingDescription[reminder.id]" class="reminder-description">
                {{ reminder.description }}
              </p>
              <input 
                *ngIf="editingDescription[reminder.id]"
                type="text" 
                [value]="reminder.description || ''"
                (blur)="onDescriptionChange(reminder, $event)"
                (keyup.enter)="onDescriptionChange(reminder, $event)"
                placeholder="Add description"
                class="edit-input description-input">
              <button (click)="toggleEditDescription(reminder.id)" class="edit-btn" title="Edit description">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div *ngIf="reminder.dueDate" class="due-date-field">
              <span class="due-date-label">Due:</span>
              <span class="due-date-value">{{ reminder.dueDate | date:'MMM d, y' }}</span>
            </div>
          </div>
          
          <div class="reminder-actions">
            <button (click)="showCopyModal(reminder)" class="copy-btn" title="Copy to another month">
              <i class="glyphicon glyphicon-copy"></i>
            </button>
            <button (click)="deleteReminder(reminder.id)" class="delete-btn">
              <i class="glyphicon glyphicon-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="getAllCompletedReminders().length > 0" class="main-section">
      <div class="main-section-header">
        <h4 class="section-title completed">Completed Reminders ({{ getAllCompletedReminders().length }})</h4>
      </div>
      
      <div class="section-reminders">
        <div *ngFor="let reminder of getAllCompletedReminders()" class="reminder-item completed">
          <div class="reminder-checkbox">
            <input 
              type="checkbox" 
              [checked]="reminder.isCompleted"
              (change)="toggleCompletion(reminder)"
              class="completion-checkbox">
          </div>
          
          <div class="reminder-content">
            <div class="editable-field">
              <h5 *ngIf="!editingTitle[reminder.id]" class="completed-text">{{ reminder.title }}</h5>
              <input 
                *ngIf="editingTitle[reminder.id]"
                type="text" 
                [value]="reminder.title"
                (blur)="onTitleChange(reminder, $event)"
                (keyup.enter)="onTitleChange(reminder, $event)"
                class="edit-input title-input">
              <button (click)="toggleEditTitle(reminder.id)" class="edit-btn" title="Edit title">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div class="editable-field">
              <p *ngIf="!editingDay[reminder.id]" class="reminder-date completed-text">{{ getFormattedDate(reminder.day) }}</p>
              <select 
                *ngIf="editingDay[reminder.id]"
                [value]="reminder.day"
                (change)="onDayChange(reminder, $event)"
                (blur)="toggleEditDay(reminder.id)"
                class="edit-input day-input">
                <option *ngFor="let day of getDaysInMonth()" [value]="day">
                  {{ getFormattedDate(day) }}
                </option>
              </select>
              <button (click)="toggleEditDay(reminder.id)" class="edit-btn" title="Edit day">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div class="due-date-display">
              <span class="due-label">Due Date:</span>
              <span class="due-value completed-text">{{ getFormattedDate(reminder.day) }}</span>
            </div>
            
            <div *ngIf="reminder.description || editingDescription[reminder.id]" class="editable-field">
              <p *ngIf="!editingDescription[reminder.id]" class="reminder-description completed-text">
                {{ reminder.description }}
              </p>
              <input 
                *ngIf="editingDescription[reminder.id]"
                type="text" 
                [value]="reminder.description || ''"
                (blur)="onDescriptionChange(reminder, $event)"
                (keyup.enter)="onDescriptionChange(reminder, $event)"
                placeholder="Add description"
                class="edit-input description-input">
              <button (click)="toggleEditDescription(reminder.id)" class="edit-btn" title="Edit description">
                <i class="glyphicon glyphicon-pencil"></i>
              </button>
            </div>
            
            <div *ngIf="reminder.dueDate" class="due-date-field">
              <span class="due-date-label">Due:</span>
              <span class="due-date-value completed-text">{{ reminder.dueDate | date:'MMM d, y' }}</span>
            </div>
          </div>
          
          <div class="completion-time">
            <div class="completion-display">
              <span class="completion-label">Completed:</span>
              <div class="completion-field">
                <span 
                  *ngIf="!isEditingCompletionTime(reminder.id)" 
                  class="completion-text">
                  {{ formatCompletionTime(reminder.completedAt) }}
                </span>
                <input 
                  *ngIf="isEditingCompletionTime(reminder.id)"
                  type="datetime-local" 
                  [value]="getEditableDateTime(reminder.completedAt)"
                  (change)="onCompletionTimeChange(reminder, $event); toggleEditCompletionTime(reminder.id)"
                  (blur)="toggleEditCompletionTime(reminder.id)"
                  class="completion-input"
                  #completionInput>
                <button 
                  (click)="toggleEditCompletionTime(reminder.id)"
                  class="edit-time-btn"
                  title="Edit completion time">
                  <i class="glyphicon glyphicon-pencil"></i>
                </button>
              </div>
            </div>
          </div>
          
          <div class="reminder-actions">
            <button (click)="deleteReminder(reminder.id)" class="delete-btn">
              <i class="glyphicon glyphicon-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Copy Reminder Modal -->
<div *ngIf="showCopyReminderModal" class="modal-overlay" (click)="closeCopyModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h4>Copy Reminder: {{ reminderToCopy?.title }}</h4>
    <div class="copy-form">
      <div class="form-group">
        <label>Month:</label>
        <select [(ngModel)]="copyToMonth" class="month-select">
          <option *ngFor="let month of months" [value]="month.value">
            {{ month.name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>Year:</label>
        <select [(ngModel)]="copyToYear" class="year-select">
          <option [value]="2024">2024</option>
          <option [value]="2025">2025</option>
          <option [value]="2026">2026</option>
        </select>
      </div>
      <div class="form-group">
        <label>Due Date:</label>
        <select [(ngModel)]="copyToDay" class="day-select">
          <option *ngFor="let day of getCopyDaysInMonth()" [value]="day">
            {{ getCopyFormattedDate(day) }}
          </option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button (click)="confirmCopy()" class="confirm-btn">Copy</button>
      <button (click)="closeCopyModal()" class="cancel-btn">Cancel</button>
    </div>
  </div>
</div>